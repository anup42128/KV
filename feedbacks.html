<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Class Voice - Student Feedback Portal</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="styles.css"><style> .custom-message { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 30px; border-radius: 10px; font-size: 1rem; font-weight: 500; opacity: 0; transition: all 0.3s ease; z-index: 1001; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); text-align: center; width: 90%; max-width: 500px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); } .custom-message.success { background: rgba(46, 213, 115, 0.2); color: #2ed573; border: 1px solid rgba(46, 213, 115, 0.3); } .custom-message.error { background: rgba(255, 71, 87, 0.2); color: #ff4757; border: 1px solid rgba(255, 71, 87, 0.3); } .custom-message.warning { background: rgba(255, 165, 2, 0.2); color: #ffa502; border: 1px solid rgba(255, 165, 2, 0.3); } .custom-message.confirm { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--white); padding: 20px; width: 90%; max-width: 400px; } .confirm-content { display: flex; flex-direction: column; align-items: center; gap: 15px; } .confirm-icon { font-size: 2rem; margin-bottom: 5px; } .confirm-message { text-align: center; font-size: 1rem; font-weight: 500; color: rgba(255, 255, 255, 0.9); line-height: 1.5; } .confirm-buttons { display: flex; gap: 12px; margin-top: 5px; width: 100%; justify-content: center; } .confirm-button { font-family: 'Poppins', sans-serif; padding: 8px 20px; border-radius: 8px; font-size: 0.95rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; border: none; min-width: 100px; } .cancel-button { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.8); border: 1px solid rgba(255, 255, 255, 0.2); } .confirm-yes { background: linear-gradient(135deg, #ff4757 0%, #ff6b81 100%); color: white; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3); } .confirm-button:hover { transform: translateY(-2px); } .cancel-button:hover { background: rgba(255, 255, 255, 0.15); } .confirm-yes:hover { box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4); } .confirm-button:active { transform: translateY(0); } .custom-message.show { opacity: 1; transform: translateX(-50%) translateY(0); } @media screen and (max-width: 768px) { .custom-message.confirm { width: calc(100% - 40px); padding: 15px; } .confirm-message { font-size: 0.95rem; } .confirm-button { padding: 8px 15px; font-size: 0.9rem; min-width: 90px; } .confirm-icon { font-size: 1.75rem; } } @media screen and (max-width: 768px) { .custom-message { width: calc(100% - 40px); padding: 12px 20px; font-size: 0.9rem; top: 80px; } } body { font-family: 'Poppins', sans-serif; line-height: 1.6; color: var(--text-primary); background-color: var(--bg-primary); overflow-x: hidden; transition: background-color 0.3s ease, color 0.3s ease; min-height: 100vh; } .page-header { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); padding: 15px 0; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); border-bottom: 1px solid rgba(255, 255, 255, 0.2); } .header-container { max-width: 1400px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; justify-content: center; gap: 15px; position: relative; } .header-content { text-align: center; } .header-buttons-left { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); } .header-buttons-right { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); } .header-btn { background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); padding: 8px 20px; border-radius: 25px; font-size: 0.9rem; font-weight: 600; font-family: 'Poppins', sans-serif; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); position: relative; display: flex; align-items: center; gap: 8px; } .header-btn:hover { background: rgba(255, 255, 255, 0.3); border-color: rgba(255, 255, 255, 0.5); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); } .header-btn:active { transform: translateY(0); } .header-btn:disabled { opacity: 0.6 !important; cursor: not-allowed !important; pointer-events: none; } .header-btn:disabled:hover { transform: none !important; box-shadow: none !important; background: rgba(255, 255, 255, 0.2) !important; border-color: rgba(255, 255, 255, 0.3) !important; } .btn-icon { font-size: 1.1rem; } .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); z-index: 2000; animation: fadeIn 0.3s ease; } .modal-overlay.active { display: flex; align-items: center; justify-content: center; } .post-options-modal { background: rgba(30, 30, 40, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 25px; max-width: 320px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); position: relative; animation: slideUp 0.3s ease; } @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .modal-header { text-align: center; margin-bottom: 20px; } .modal-title { font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 8px; } .modal-subtitle { font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); } .modal-close { position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 1.3rem; color: rgba(255, 255, 255, 0.6); cursor: pointer; transition: all 0.3s ease; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; } .modal-close:hover { background: rgba(255, 255, 255, 0.1); color: #ffffff; transform: rotate(90deg); } .options-container { display: flex; flex-direction: column; gap: 12px; } .option-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px; } .option-btn:hover { background: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.4); transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3); } .option-icon { font-size: 1.5rem; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; } .option-btn:hover .option-icon { background: rgba(255, 255, 255, 0.15); } .option-content { flex: 1; text-align: left; } .option-title { font-size: 1rem; font-weight: 600; margin-bottom: 3px; color: #ffffff; } .option-description { font-size: 0.8rem; color: rgba(255, 255, 255, 0.6); line-height: 1.3; } .option-btn:hover .option-description { color: rgba(255, 255, 255, 0.8); } .option-btn.logout-option { border-color: rgba(255, 107, 107, 0.3); } .option-btn.logout-option:hover { background: rgba(255, 107, 107, 0.1); border-color: rgba(255, 107, 107, 0.4); } .option-btn.logout-option .option-icon { background: rgba(255, 107, 107, 0.1); } .option-btn.logout-option:hover .option-icon { background: rgba(255, 107, 107, 0.2); } .header-title { font-size: 1.5rem; font-weight: 600; color: var(--white); text-transform: uppercase; letter-spacing: 1.5px; margin: 0; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); } .header-subtitle { font-size: 0.85rem; color: rgba(255, 255, 255, 0.85); text-align: center; margin-top: 3px; font-weight: 400; letter-spacing: 0.3px; } .main-container { margin-top: 75px; padding: 20px 20px 40px 20px; max-width: 1400px; margin-left: auto; margin-right: auto; } .feedbacks-btn-container { display: flex; justify-content: center; margin-bottom: 25px; } .all-feedbacks-btn { background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); padding: 8px 15px; border-radius: 25px; font-size: 0.9rem; font-weight: 600; font-family: 'Poppins', sans-serif; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; align-items: center; gap: 8px; } .all-feedbacks-btn:hover { background: rgba(255, 255, 255, 0.3); border-color: rgba(255, 255, 255, 0.5); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); } .all-feedbacks-btn:active { transform: translateY(0); } .feedbacks-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; padding: 0 20px; max-width: 1400px; margin-left: auto; margin-right: auto; } .feedback-card { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; animation: fadeInUp 0.5s ease; display: flex; flex-direction: column; min-height: 180px; } @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } .feedback-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); } .feedback-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); flex-shrink: 0; } .feedback-username { font-size: 0.95rem; font-weight: 600; color: var(--white); display: flex; align-items: center; gap: 6px; } .feedback-username.anonymous { font-style: italic; opacity: 0.9; } .report-btn { background: transparent; border: none; color: rgba(255, 255, 255, 0.5); font-size: 1.2rem; cursor: pointer; padding: 5px; transition: all 0.3s ease; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; } .report-btn:hover { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.8); transform: scale(1.1); } .feedback-date { font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); display: flex; align-items: center; gap: 5px; flex-direction: column; text-align: right; } .feedback-time { font-size: 0.8rem; color: rgba(255, 255, 255, 0.5); margin-top: 2px; display: flex; align-items: center; gap: 3px; } .feedback-text { font-size: 1rem; font-weight: 600; color: var(--white); line-height: 1.5; word-wrap: break-word; word-break: break-word; margin-top: 10px; flex-grow: 1; } .loading-message, .empty-message { grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: rgba(255, 255, 255, 0.7); font-size: 1.1rem; display: flex; flex-direction: column; align-items: center; gap: 15px; } .loading-icon { font-size: 2rem; animation: spin 1s linear infinite; } @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } } .empty-icon { font-size: 3rem; opacity: 0.5; } @media (max-width: 1024px) { .feedbacks-container { grid-template-columns: repeat(2, 1fr); } } @media (max-width: 768px) { .page-header { padding: 12px 0; } .header-container { padding: 0 10px; } .header-content { padding: 0 90px; } .post-feedback-btn { padding: 5px 8px; } .post-feedback-btn .btn-text { font-size: 0.75rem; } .header-title { font-size: 1.1rem; letter-spacing: 0.5px; } .header-subtitle { font-size: 0.7rem; display: none; } .header-buttons-left { left: 10px; } .header-buttons-right { right: 10px; } .header-btn { padding: 6px 10px; font-size: 0.8rem; border-width: 1px; } .header-btn .btn-text { display: none; } .post-feedback-btn .btn-text { display: inline !important; font-size: 0.8rem; font-weight: 600; } .post-feedback-btn .btn-icon { display: none; } .post-feedback-btn.cooldown-active .btn-icon { display: inline !important; } .header-btn:disabled .btn-text, .header-btn.cooldown-active .btn-text { display: inline !important; font-size: 0.7rem !important; font-weight: 600 !important; } .header-btn.cooldown-active { padding: 6px 12px !important; min-width: 50px; } .header-btn .btn-icon { font-size: 1rem; } .main-container { margin-top: 65px; padding: 15px 15px 30px 15px; } .all-feedbacks-btn { padding: 8px 15px; font-size: 0.75rem; } .all-feedbacks-btn .btn-text { display: inline; } .all-feedbacks-btn .btn-icon { font-size: 0.9rem; } .feedbacks-container { grid-template-columns: 1fr; gap: 15px; padding: 0 15px; } .feedback-card { padding: 15px; } } @media (max-width: 480px) { .page-header { padding: 10px 0; } .header-container { padding: 0 8px; } .header-title { font-size: 0.95rem; letter-spacing: 0; } .header-buttons-left { left: 8px; } .header-buttons-right { right: 8px; } .header-btn { padding: 5px 8px; border-radius: 20px; } .header-btn .btn-icon { font-size: 0.9rem; } .header-btn:disabled .btn-text, .header-btn.cooldown-active .btn-text { display: inline !important; font-size: 0.65rem !important; font-weight: 600 !important; } .header-btn.cooldown-active { padding: 5px 10px !important; min-width: 45px; gap: 3px !important; } .main-container { margin-top: 55px; padding: 10px 15px 30px 15px; } .feedbacks-btn-container { margin-bottom: 20px; } .all-feedbacks-btn { padding: 7px 12px; font-size: 0.7rem; gap: 6px; } .all-feedbacks-btn .btn-icon { font-size: 0.85rem; } .all-feedbacks-btn .btn-text { display: inline; letter-spacing: 0.3px; } .post-options-modal { padding: 20px; width: 95%; } .modal-title { font-size: 1.2rem; } .option-btn { padding: 12px; } .option-icon { width: 35px; height: 35px; font-size: 1.3rem; } } .content-placeholder { background: var(--card-bg); border-radius: 20px; padding: 40px; text-align: center; box-shadow: var(--shadow-medium); animation: fadeIn 0.8s ease-out; transition: all 0.3s ease; } @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } .content-placeholder h2 { color: var(--primary-blue); font-size: 1.5rem; margin-bottom: 15px; } .content-placeholder p { color: var(--text-secondary); font-size: 1rem; line-height: 1.6; } .comments-section { margin-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 15px; } .comments-header { margin-bottom: 10px; display: flex; gap: 8px; align-items: center; } .comments-toggle-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 25px; padding: 8px 16px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; color: var(--white); font-family: 'Poppins', sans-serif; font-size: 0.9rem; font-weight: 500; flex: 1; justify-content: space-between; } .comments-refresh-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 50%; width: 36px; height: 36px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 0.9rem; } .comments-refresh-btn:hover { background: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.3); transform: rotate(180deg); } .comments-toggle-btn:hover { background: rgba(255, 255, 255, 0.15); border-color: rgba(255, 255, 255, 0.3); transform: translateY(-1px); } .comments-toggle-btn:active { transform: translateY(0); } .comments-toggle-btn .comment-icon { font-size: 1.1rem; } .comments-toggle-btn .comment-count { background: rgba(255, 255, 255, 0.2); padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; min-width: 20px; text-align: center; } .comments-toggle-btn .comment-label { flex: 1; text-align: left; margin-left: 5px; } .comments-toggle-btn .toggle-arrow { font-size: 0.8rem; transition: transform 0.3s ease; } .comments-container { margin-top: 15px; animation: slideDown 0.3s ease; } @keyframes slideDown { from { opacity: 0; max-height: 0; transform: translateY(-10px); } to { opacity: 1; max-height: 1000px; transform: translateY(0); } } .comments-list { max-height: 400px; overflow-y: auto; margin-bottom: 15px; padding-right: 5px; } .comments-list::-webkit-scrollbar { width: 4px; } .comments-list::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 2px; } .comments-list::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 2px; } .comments-list::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.4); } .comment-item { background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 12px; margin-bottom: 10px; transition: all 0.3s ease; } .comment-item:hover { background: rgba(255, 255, 255, 0.12); border-color: rgba(255, 255, 255, 0.25); transform: translateY(-1px); } .comment-item:last-child { margin-bottom: 0; } .comment-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); } .comment-username { display: flex; align-items: center; gap: 6px; font-size: 0.85rem; font-weight: 600; color: var(--white); } .comment-username.anonymous { font-style: italic; opacity: 0.9; } .comment-user-icon { font-size: 0.9rem; } .comment-actions { display: flex; align-items: center; gap: 8px; } .comment-date { font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); white-space: nowrap; } .comment-delete-btn, .comment-report-btn { background: transparent; border: none; color: rgba(255, 255, 255, 0.5); cursor: pointer; padding: 4px; border-radius: 50%; transition: all 0.3s ease; font-size: 0.9rem; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; } .comment-delete-btn:hover { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; } .comment-report-btn:hover { background: rgba(255, 165, 2, 0.2); color: #ffa502; } .comment-text { font-size: 0.9rem; color: var(--white); line-height: 1.4; word-wrap: break-word; word-break: break-word; } .comment-input-section { border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 15px; } .comment-input-container { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 12px; transition: all 0.3s ease; } .comment-input-container:focus-within { background: rgba(255, 255, 255, 0.08); border-color: rgba(255, 255, 255, 0.25); box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1); } .comment-input { width: 100%; background: transparent; border: none; color: var(--white); font-family: 'Poppins', sans-serif; font-size: 0.9rem; line-height: 1.4; resize: vertical; min-height: 40px; max-height: 120px; outline: none; padding: 0; } .comment-input::placeholder { color: rgba(255, 255, 255, 0.5); } .comment-input:focus::placeholder { color: rgba(255, 255, 255, 0.3); } .comment-input-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; gap: 15px; } .comment-char-count { font-size: 0.75rem; color: var(--text-secondary); font-weight: 500; } .comment-input-buttons { display: flex; align-items: center; gap: 12px; } .comment-type-toggle { display: flex; align-items: center; gap: 8px; } .toggle-switch { position: relative; display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.8rem; color: rgba(255, 255, 255, 0.7); } .toggle-switch input { position: absolute; opacity: 0; cursor: pointer; } .toggle-slider { position: relative; width: 36px; height: 20px; background: rgba(255, 255, 255, 0.2); border-radius: 20px; transition: all 0.3s ease; } .toggle-slider:before { content: ""; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background: white; border-radius: 50%; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); } .toggle-switch input:checked + .toggle-slider { background: #7c3aed; } .toggle-switch input:checked + .toggle-slider:before { transform: translateX(16px); } .toggle-switch:hover .toggle-slider { background: rgba(255, 255, 255, 0.3); } .toggle-switch input:checked:hover + .toggle-slider { background: #8b5cf6; } .toggle-label { font-weight: 500; user-select: none; } .comment-submit-btn { background: linear-gradient(135deg, #3b82f6 0%, #7c3aed 100%); border: none; border-radius: 8px; padding: 8px 16px; color: white; font-family: 'Poppins', sans-serif; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); } .comment-submit-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); } .comment-submit-btn:active { transform: translateY(0); } .comment-submit-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2); } .comment-submit-btn .btn-icon { font-size: 1rem; } .comments-loading, .no-comments, .comments-error { text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; display: flex; flex-direction: column; align-items: center; gap: 8px; } .comments-loading .loading-icon { font-size: 1.5rem; animation: spin 1s linear infinite; } .no-comments .no-comments-icon { font-size: 2rem; opacity: 0.5; } .comments-error .error-icon { font-size: 1.5rem; color: #ff6b6b; } @media (max-width: 768px) { .comments-section { margin-top: 12px; padding-top: 12px; } .comments-toggle-btn { padding: 6px 12px; font-size: 0.85rem; } .comments-toggle-btn .comment-count { padding: 1px 6px; font-size: 0.75rem; } .comment-item { padding: 10px; margin-bottom: 8px; } .comment-header { flex-direction: column; align-items: flex-start; gap: 5px; } .comment-actions { align-self: flex-end; gap: 6px; } .comment-username { font-size: 0.8rem; } .comment-date { font-size: 0.7rem; } .comment-text { font-size: 0.85rem; } .comment-input-container { padding: 10px; } .comment-input { font-size: 0.85rem; } .comment-input-footer { flex-direction: column; align-items: stretch; gap: 10px; } .comment-input-buttons { justify-content: space-between; } .comment-submit-btn { padding: 8px 12px; font-size: 0.8rem; } } @media (max-width: 480px) { .comments-toggle-btn { padding: 5px 10px; font-size: 0.8rem; } .comment-item { padding: 8px; } .comment-input-container { padding: 8px; } .toggle-switch { font-size: 0.75rem; } .toggle-slider { width: 32px; height: 18px; } .toggle-slider:before { width: 14px; height: 14px; } .toggle-switch input:checked + .toggle-slider:before { transform: translateX(14px); } } </style></head><body><div id="customMessage" class="custom-message"></div><div class="bg-animation"><div class="floating-shape shape1"></div><div class="floating-shape shape2"></div><div class="floating-shape shape3"></div><div class="floating-shape shape4"></div><div class="floating-shape shape5"></div></div><header class="page-header"><div class="header-container"><div class="header-buttons-left"><button class="header-btn post-feedback-btn" onclick="openPostFeedback()"><span class="btn-icon">‚úçÔ∏è</span><span class="btn-text">Post a Feedback</span></button></div><div class="header-content"><h1 class="header-title">CLASS VOICE</h1><p class="header-subtitle">Student Feedback Portal</p></div><div class="header-buttons-right"><button class="header-btn settings-btn" onclick="openSettings()"><span class="btn-icon">‚öôÔ∏è</span><span class="btn-text">Settings</span></button></div></div></header><div id="modalOverlay" class="modal-overlay"><div class="post-options-modal"><button class="modal-close" onclick="closePostOptions()">&times;</button><div class="modal-header"><h2 class="modal-title">Post Feedback</h2><p class="modal-subtitle">Choose how you want to share your feedback</p></div><div class="options-container"><button class="option-btn" onclick="postWithName()"><div class="option-icon">üë§</div><div class="option-content"><div class="option-title">Post With Name</div><div class="option-description">Your name will be visible with your feedback</div></div></button><button class="option-btn" onclick="postAnonymously()"><div class="option-icon">üé≠</div><div class="option-content"><div class="option-title">Post Anonymously</div><div class="option-description">Your identity will remain hidden</div></div></button><button class="option-btn" onclick="openComplaint()"><div class="option-icon">üì®</div><div class="option-content"><div class="option-title">Submit Anonymous Complaint</div><div class="option-description">Private complaint stored anonymously; only admins can view.</div></div></button></div></div></div><div id="settingsModalOverlay" class="modal-overlay"><div class="post-options-modal"><button class="modal-close" onclick="closeSettings()">&times;</button><div class="modal-header"><h2 class="modal-title">Settings</h2><p class="modal-subtitle">Choose an option to view feedbacks</p></div><div class="options-container"><button class="option-btn" onclick="seeYourFeedbacks()"><div class="option-icon">üë§</div><div class="option-content"><div class="option-title">See Your Feedbacks</div><div class="option-description">View only the feedbacks you have posted</div></div></button><button class="option-btn" onclick="showAllFeedbacks()"><div class="option-icon">üåê</div><div class="option-content"><div class="option-title">Show All Feedbacks</div><div class="option-description">View feedbacks from everyone</div></div></button><button class="option-btn" onclick="individualTalking()"><div class="option-icon">üó£Ô∏è</div><div class="option-content"><div class="option-title">Individual Talking</div><div class="option-description">Start a private conversation with a specific user</div></div></button><button class="option-btn" onclick="toggleAutoRefresh()"><div class="option-icon">üîÑ</div><div class="option-content"><div class="option-title">Auto Refresh: <span id="autoRefreshStatus">OFF</span></div><div class="option-description">Automatically refresh when new feedbacks are posted</div></div></button><button class="option-btn logout-option" onclick="logoutUser()"><div class="option-icon">üö™</div><div class="option-content"><div class="option-title">Log Out</div><div class="option-description">Sign out of your account</div></div></button></div></div></div><main class="main-container"><div class="feedbacks-btn-container"><button class="all-feedbacks-btn" onclick="viewAllFeedbacks()"><span class="btn-icon">üí¨</span><span class="btn-text">New Feedbacks?</span></button></div><div id="feedbacksContainer" class="feedbacks-container"><div class="loading-message"><span class="loading-icon">üîÑ</span><span>Loading feedbacks...</span></div></div></main><script> let feedbackCooldownActive = false; let cooldownEndTime = null; let autoRefreshEnabled = false; let autoRefreshInterval = null; let cooldownInterval = null; const COOLDOWN_DURATION = 45; document.addEventListener('DOMContentLoaded', function() { const header = document.querySelector('.page-header'); let lastScroll = 0; window.addEventListener('scroll', () => { const currentScroll = window.pageYOffset; if (currentScroll <= 0) { header.style.transform = 'translateY(0)'; } else if (currentScroll > lastScroll && currentScroll > 100) { header.style.transform = 'translateY(-10px)'; header.style.opacity = '0.95'; } else { header.style.transform = 'translateY(0)'; header.style.opacity = '1'; } lastScroll = currentScroll; }); const urlParams = new URLSearchParams(window.location.search); const urlUsername = urlParams.get('username'); let username = urlUsername || sessionStorage.getItem('currentUsername'); if (username && username !== 'Guest') { console.log('‚úÖ User logged in:', username); window.currentUser = username; sessionStorage.setItem('currentUsername', username); } else { console.log('‚ö†Ô∏è No user logged in - checking for stored session'); username = sessionStorage.getItem('currentUsername'); if (username) { window.currentUser = username; console.log('‚úÖ Found stored user:', username); } } checkExistingCooldown(); checkForCooldownTrigger(); console.log('‚ú® KV Feedbacks page loaded successfully!'); console.log('üìù Ready to display feedbacks...'); const postBtnTextEl = document.querySelector('.post-feedback-btn .btn-text'); if (postBtnTextEl && window.innerWidth <= 768) { postBtnTextEl.textContent = 'Post'; } }); function checkForCooldownTrigger() { const shouldTriggerCooldown = sessionStorage.getItem('triggerCooldownOnReturn'); if (shouldTriggerCooldown === 'true') { sessionStorage.removeItem('triggerCooldownOnReturn'); startFeedbackCooldown(); console.log('üîí Feedback cooldown started - button locked for 45 seconds'); } } function checkExistingCooldown() { const storedCooldownEnd = localStorage.getItem('feedbackCooldownEnd'); if (storedCooldownEnd) { const cooldownEnd = parseInt(storedCooldownEnd); const now = Date.now(); if (now < cooldownEnd) { cooldownEndTime = cooldownEnd; feedbackCooldownActive = true; startCooldownDisplay(); } else { localStorage.removeItem('feedbackCooldownEnd'); } } } function startFeedbackCooldown() { feedbackCooldownActive = true; cooldownEndTime = Date.now() + (COOLDOWN_DURATION * 1000); localStorage.setItem('feedbackCooldownEnd', cooldownEndTime.toString()); startCooldownDisplay(); } function startCooldownDisplay() { const postBtn = document.querySelector('.post-feedback-btn'); const btnText = postBtn.querySelector('.btn-text'); const btnIcon = postBtn.querySelector('.btn-icon'); postBtn.disabled = true; postBtn.classList.add('cooldown-active'); postBtn.style.opacity = '0.6'; postBtn.style.cursor = 'not-allowed'; btnIcon.textContent = '‚è∞'; cooldownInterval = setInterval(() => { const now = Date.now(); const timeLeft = Math.ceil((cooldownEndTime - now) / 1000); if (timeLeft <= 0) { clearInterval(cooldownInterval); feedbackCooldownActive = false; cooldownEndTime = null; localStorage.removeItem('feedbackCooldownEnd'); postBtn.disabled = false; postBtn.classList.remove('cooldown-active'); postBtn.style.opacity = ''; postBtn.style.cursor = ''; btnIcon.textContent = '‚úçÔ∏è'; const defaultLabel = (window.innerWidth <= 768) ? 'Post' : 'Post a Feedback'; btnText.textContent = defaultLabel; console.log('‚úÖ Feedback cooldown finished - button re-enabled'); } else { btnText.textContent = `${timeLeft}s`; } }, 1000); } function openPostFeedback() { if (feedbackCooldownActive) { const timeLeft = Math.ceil((cooldownEndTime - Date.now()) / 1000); showCustomMessage(`Please wait ${timeLeft} seconds before posting again`, 'warning'); return; } console.log('üìù Opening feedback options...'); const modal = document.getElementById('modalOverlay'); modal.classList.add('active'); document.body.style.overflow = 'hidden'; } function closePostOptions() { console.log('Closing feedback options modal...'); const modal = document.getElementById('modalOverlay'); modal.classList.remove('active'); document.body.style.overflow = ''; } function postWithName() { console.log('üë§ Posting with name selected'); closePostOptions(); const username = window.currentUser || sessionStorage.getItem('currentUsername') || 'Guest'; console.log('üìù Posting feedback with username:', username); window.location.href = `post-feedback.html?username=${encodeURIComponent(username)}`; } function postAnonymously() { console.log('üé≠ Posting anonymously selected'); closePostOptions(); const username = window.currentUser || 'Guest'; window.location.href = `post-anonymous.html?username=${encodeURIComponent(username)}`; } function openComplaint() { closePostOptions(); window.location.href = 'complaint.html'; } document.addEventListener('click', function(e) { const postModal = document.getElementById('modalOverlay'); const settingsModal = document.getElementById('settingsModalOverlay'); if (e.target === postModal) { closePostOptions(); } else if (e.target === settingsModal) { closeSettings(); } }); document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { const postModal = document.getElementById('modalOverlay'); const settingsModal = document.getElementById('settingsModalOverlay'); if (postModal.classList.contains('active')) { closePostOptions(); } else if (settingsModal.classList.contains('active')) { closeSettings(); } } }); function openSettings() { console.log('‚öôÔ∏è Opening settings modal...'); const modal = document.getElementById('settingsModalOverlay'); modal.classList.add('active'); document.body.style.overflow = 'hidden'; } function closeSettings() { console.log('Closing settings modal...'); const modal = document.getElementById('settingsModalOverlay'); modal.classList.remove('active'); document.body.style.overflow = ''; } function seeYourFeedbacks() { console.log('üë§ Viewing your feedbacks...'); closeSettings(); const username = window.currentUser || sessionStorage.getItem('currentUsername'); if (username && username !== 'Guest') { window.location.href = `my-feedbacks.html?username=${encodeURIComponent(username)}`; } else { showCustomMessage('Please log in to view your feedbacks', 'warning'); } } function showAllFeedbacks() { console.log('üåê Viewing all feedbacks...'); closeSettings(); loadFeedbacks(); } async function logoutUser() { console.log('üö™ Logout requested...'); closeSettings(); const confirmed = await showCustomConfirmation('Are you sure you want to log out?'); if (!confirmed) { return; } console.log('üö™ Logging out user...'); try { if (window.SessionManager) { if (window.DatabaseHelper && window.DatabaseHelper.logout) { const user = window.SessionManager.getCurrentUser(); if (user.sessionToken) { await window.DatabaseHelper.logout(user.sessionToken); } } window.SessionManager.clearSession(); showCustomMessage('Logged out successfully!', 'success'); setTimeout(() => { window.location.href = 'index.html'; }, 1500); } else { sessionStorage.removeItem('currentUsername'); localStorage.removeItem('feedbackCooldownEnd'); if (window.DatabaseHelper && window.DatabaseHelper.logout) { const sessionToken = sessionStorage.getItem('sessionToken'); await window.DatabaseHelper.logout(sessionToken); sessionStorage.removeItem('sessionToken'); } sessionStorage.clear(); showCustomMessage('Logged out successfully!', 'success'); setTimeout(() => { window.location.href = 'index.html'; }, 1500); } } catch (error) { console.error('‚ùå Logout error:', error); showCustomMessage('Logged out (with some errors)', 'warning'); setTimeout(() => { window.location.href = 'index.html'; }, 1500); } } function individualTalking() { console.log('üó£Ô∏è Individual Talking feature selected'); closeSettings(); window.location.href = 'individual-talking.html'; } function viewAllFeedbacks() { console.log('üí¨ Viewing all feedbacks...'); loadFeedbacks(); } async function loadFeedbacks() { const container = document.getElementById('feedbacksContainer'); container.innerHTML = ` <div class="loading-message"><span class="loading-icon">üîÑ</span><span>Loading feedbacks...</span></div> `; if (window.DatabaseHelper && window.DatabaseHelper.getAllFeedbacksWithComments) { console.log('üîç Attempting to fetch feedbacks with comments from database...'); const result = await window.DatabaseHelper.getAllFeedbacksWithComments(); if (result.success && result.feedbacks && result.feedbacks.length > 0) { console.log(`‚úÖ Displaying ${result.feedbacks.length} feedbacks with comment counts`); displayFeedbacks(result.feedbacks); } else if (result.success && (!result.feedbacks || result.feedbacks.length === 0)) { console.log('üì¢ No feedbacks found in database'); container.innerHTML = ` <div class="empty-message"><span class="empty-icon">üì¢</span><span>No feedbacks yet</span><span style="font-size: 0.9rem; opacity: 0.8;">Be the first to share your thoughts!</span></div> `; } else { console.error('‚ùå Failed to load feedbacks:', result.error); container.innerHTML = ` <div class="empty-message"><span class="empty-icon">‚ö†Ô∏è</span><span>Failed to load feedbacks</span><span style="font-size: 0.9rem; opacity: 0.8;">${result.error || 'Please try again later'}</span></div> `; } } else { console.error('‚ùå DatabaseHelper is not available'); container.innerHTML = ` <div class="empty-message"><span class="empty-icon">‚ö†Ô∏è</span><span>DatabaseHelper is not available</span><span style="font-size: 0.9rem; opacity: 0.8;">Please try again later</span></div> `; } } function displayFeedbacks(feedbacks) { const container = document.getElementById('feedbacksContainer'); container.innerHTML = ''; feedbacks.forEach(feedback => { const feedbackElement = document.createElement('div'); feedbackElement.classList.add('feedback'); feedbackElement.innerHTML = ` <div class="feedback-header"><span class="feedback-author">${feedback.author}</span><span class="feedback-date">${formatDate(feedback.date)}</span></div><div class="feedback-content"><p>${feedback.content}</p></div><div class="feedback-comments"><span class="comment-count">${feedback.commentCount || 0} comments</span><button class="view-comments-btn" onclick="viewComments('${feedback.id}')">View Comments</button></div> `; container.appendChild(feedbackElement); }); } function formatDate(dateString) { const date = new Date(dateString); return date.toLocaleDateString() + ' ' + date.toLocaleTimeString(); } function viewComments(feedbackId) { console.log(`üí¨ Viewing comments for feedback ID: ${feedbackId}`); closeSettings(); window.location.href = `comments.html?feedbackId=${encodeURIComponent(feedbackId)}`; } function showCustomMessage(message, type) { const messageContainer = document.getElementById('customMessageContainer'); messageContainer.innerHTML = ` <div class="custom-message ${type}"><span>${message}</span></div> `; messageContainer.style.display = 'block'; setTimeout(() => { messageContainer.style.display = 'none'; }, 3000); } function showCustomConfirmation(message) { return new Promise((resolve) => { const confirmationContainer = document.getElementById('confirmationContainer'); confirmationContainer.innerHTML = ` <div class="confirmation-dialog"><span>${message}</span><div class="confirmation-buttons"><button onclick="resolveConfirmation(true)">Yes</button><button onclick="resolveConfirmation(false)">No</button></div></div> `; confirmationContainer.style.display = 'block'; window.resolveConfirmation = (confirmed) => { confirmationContainer.style.display = 'none'; resolve(confirmed); }; }); } function openSettings() { console.log('üîß Opening settings modal...'); const modal = document.getElementById('settingsModalOverlay'); modal.classList.add('active'); document.body.style.overflow = 'hidden'; } function closeSettings() { console.log('Closing settings modal...'); const modal = document.getElementById('settingsModalOverlay'); modal.classList.remove('active'); document.body.style.overflow = ''; } function seeYourFeedbacks() { console.log('üë§ Viewing your feedbacks...'); closeSettings(); const username = window.currentUser || sessionStorage.getItem('currentUsername'); if (username && username !== 'Guest') { window.location.href = `my-feedbacks.html?username=${encodeURIComponent(username)}`; } else { showCustomMessage('Please log in to view your feedbacks', 'warning'); } } function showAllFeedbacks() { console.log('üåê Viewing all feedbacks...'); closeSettings(); loadFeedbacks(); } async function logoutUser() { console.log('üö™ Logout requested...'); closeSettings(); const confirmed = await showCustomConfirmation('Are you sure you want to log out?'); if (!confirmed) { return; } console.log('üö™ Logging out user...'); try { if (window.SessionManager) { if (window.DatabaseHelper && window.DatabaseHelper.logout) { const user = window.SessionManager.getCurrentUser(); if (user.sessionToken) { await window.DatabaseHelper.logout(user.sessionToken); } } window.SessionManager.clearSession(); showCustomMessage('Logged out successfully!', 'success'); setTimeout(() => { window.location.href = 'index.html'; }, 1500); } else { sessionStorage.removeItem('currentUsername'); localStorage.removeItem('feedbackCooldownEnd'); if (window.DatabaseHelper && window.DatabaseHelper.logout) { const sessionToken = sessionStorage.getItem('sessionToken'); await window.DatabaseHelper.logout(sessionToken); sessionStorage.removeItem('sessionToken'); } sessionStorage.clear(); showCustomMessage('Logged out successfully!', 'success'); setTimeout(() => { window.location.href = 'index.html'; }, 1500); } } catch (error) { console.error('‚ùå Logout error:', error); showCustomMessage('Logged out (with some errors)', 'warning'); setTimeout(() => { window.location.href = 'index.html'; }, 1500); } } function individualTalking() { console.log('üó£Ô∏è Individual Talking feature selected'); closeSettings(); window.location.href = 'individual-talking.html'; } function viewAllFeedbacks() { console.log('üí¨ Viewing all feedbacks...'); loadFeedbacks(); } async function loadFeedbacks() { const container = document.getElementById('feedbacksContainer'); container.innerHTML = ` <div class="loading-message"><span class="loading-icon">üîÑ</span><span>Loading feedbacks...</span></div> `; if (window.DatabaseHelper && window.DatabaseHelper.getAllFeedbacksWithComments) { console.log('üîç Attempting to fetch feedbacks with comments from database...'); const result = await window.DatabaseHelper.getAllFeedbacksWithComments(); if (result.success && result.feedbacks && result.feedbacks.length > 0) { console.log(`‚úÖ Displaying ${result.feedbacks.length} feedbacks with comment counts`); displayFeedbacks(result.feedbacks); } else if (result.success && (!result.feedbacks || result.feedbacks.length === 0)) { console.log('üì¢ No feedbacks found in database'); container.innerHTML = ` <div class="empty-message"><span class="empty-icon">üì¢</span><span>No feedbacks yet</span><span style="font-size: 0.9rem; opacity: 0.8;">Be the first to share your thoughts!</span></div> `; } else { console.error('‚ùå Failed to load feedbacks:', result.error); container.innerHTML = ` <div class="empty-message"><span class="empty-icon">‚ö†Ô∏è</span><span>Failed to load feedbacks</span><span style="font-size: 0.9rem; opacity: 0.8;">${result.error || 'Please try again later'}</span></div> `; } } else if (window.DatabaseHelper && window.DatabaseHelper.getAllFeedbacks) { console.log('üîç Using fallback method...'); const result = await window.DatabaseHelper.getAllFeedbacks(); if (result.success && result.feedbacks && result.feedbacks.length > 0) { console.log(`‚úÖ Displaying ${result.feedbacks.length} feedbacks`); displayFeedbacks(result.feedbacks); } else if (result.success && (!result.feedbacks || result.feedbacks.length === 0)) { console.log('üì¢ No feedbacks found in database'); container.innerHTML = ` <div class="empty-message"><span class="empty-icon">üì¢</span><span>No feedbacks yet</span><span style="font-size: 0.9rem; opacity: 0.8;">Be the first to share your thoughts!</span></div> `; } else { console.error('‚ùå Failed to load feedbacks:', result.error); container.innerHTML = ` <div class="empty-message"><span class="empty-icon">‚ö†Ô∏è</span><span>Failed to load feedbacks</span><span style="font-size: 0.9rem; opacity: 0.8;">${result.error || 'Please try again later'}</span></div> `; } } else { console.error('‚ùå DatabaseHelper not available'); if (!window.databaseRetryAttempted) { window.databaseRetryAttempted = true; console.log('üîÑ Retrying database connection in 1 second...'); setTimeout(() => { loadFeedbacks(); }, 1000); } else { container.innerHTML = ` <div class="empty-message"><span class="empty-icon">‚ö†Ô∏è</span><span>Unable to connect to database</span><span style="font-size: 0.9rem; opacity: 0.8;">Please check your connection and refresh the page</span></div> `; } } } function displayFeedbacks(feedbacks) { const container = document.getElementById('feedbacksContainer'); container.innerHTML = ''; console.log(`üìù Displaying ${feedbacks.length} feedbacks`); feedbacks.forEach((feedback, index) => { const card = createFeedbackCard(feedback); container.appendChild(card); setTimeout(() => { card.style.opacity = '1'; card.style.transform = 'translateY(0)'; }, index * 100); }); if (feedbacks.length > 0) { const globalRefreshBtn = document.createElement('div'); globalRefreshBtn.innerHTML = ` <div style="text-align: center; margin-top: 20px;"><button onclick="globalRefreshComments()" style=" background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 8px 16px; color: white; cursor: pointer; font-family: 'Poppins', sans-serif; font-size: 0.85rem; "> üîÑ Refresh All Comments </button></div> `; container.appendChild(globalRefreshBtn); } } function globalRefreshComments() { console.log('üîÑ Global comment refresh requested'); invalidateCache(); showCustomMessage('All comment caches cleared! Expand comments to see fresh data.', 'success'); } function createFeedbackCard(feedback) { const card = document.createElement('div'); card.className = 'feedback-card'; card.style.opacity = '0'; card.style.transform = 'translateY(20px)'; card.style.transition = 'all 0.5s ease'; card.setAttribute('data-feedback-id', feedback.id); const timeField = feedback.submission_time || feedback.created_at || new Date().toISOString(); const date = new Date(timeField); const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); const formattedTime = date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', hour12: false }); const userIcon = feedback.is_anonymous ? 'üé≠' : 'üë§'; const usernameClass = feedback.is_anonymous ? 'feedback-username anonymous' : 'feedback-username'; const commentCount = feedback.comment_count || 0; card.innerHTML = ` <div class="feedback-header"><div class="${usernameClass}"><span>${userIcon}</span><span>${feedback.username}</span></div><button class="report-btn" onclick="reportFeedback('${feedback.id}')" title="Report this feedback"> ‚Ä¢ </button><div class="feedback-date"><span>üìÖ</span><span>${formattedDate}</span><span class="feedback-time">üï∞Ô∏è ${formattedTime}</span></div></div><div class="feedback-text"> ${feedback.feedback_text} </div><div class="comments-section"><div class="comments-header"><button class="comments-toggle-btn" onclick="toggleComments('${feedback.id}')"><span class="comment-icon">üí¨</span><span class="comment-count" id="count-${feedback.id}">${commentCount}</span><span class="comment-label">Comments</span><span class="toggle-arrow" id="arrow-${feedback.id}">‚ñº</span></button><button class="comments-refresh-btn" onclick="refreshComments('${feedback.id}')" title="Refresh comments" style="display: none;" id="refresh-btn-${feedback.id}"><span class="refresh-icon">üîÑ</span></button></div><div class="comments-container" id="comments-${feedback.id}" style="display: none;"><div class="comments-list" id="comments-list-${feedback.id}"></div><div class="comment-input-section"><div class="comment-input-container"><textarea class="comment-input" id="comment-input-${feedback.id}" placeholder="Add a comment (max 500 characters)..." maxlength="500" rows="2" ></textarea><div class="comment-input-footer"><div class="comment-char-count"><span id="char-count-${feedback.id}">0</span>/500 </div><div class="comment-input-buttons"><div class="comment-type-toggle"><label class="toggle-switch"><input type="checkbox" class="anonymous-toggle" id="anon-toggle-${feedback.id}"><span class="toggle-slider"></span><span class="toggle-label">Anonymous</span></label></div><button class="comment-submit-btn" onclick="submitComment('${feedback.id}')" disabled ><span class="btn-icon">üìù</span><span class="btn-text">Post</span></button></div></div></div></div></div></div> `; setTimeout(() => { setupCommentInputListeners(feedback.id); }, 100); return card; } function showCustomMessage(message, type = 'success') { const messageElement = document.getElementById('customMessage'); messageElement.textContent = message; messageElement.className = `custom-message ${type} show`; if (window.messageTimeout) { clearTimeout(window.messageTimeout); } window.messageTimeout = setTimeout(() => { messageElement.className = 'custom-message ' + type; }, 3000); } function showCustomConfirmation(message) { return new Promise((resolve) => { let messageElement = document.getElementById('customMessage'); if (!messageElement) { messageElement = document.createElement('div'); messageElement.id = 'customMessage'; messageElement.className = 'custom-message'; document.body.insertBefore(messageElement, document.body.firstChild); } const handleClick = (result) => { messageElement.className = 'custom-message confirm'; setTimeout(() => { messageElement.innerHTML = ''; resolve(result); }, 300); }; messageElement.innerHTML = ` <div class="confirm-content"><div class="confirm-icon">‚ö†Ô∏è</div><div class="confirm-message">${message}</div><div class="confirm-buttons"><button id="confirmNo" class="confirm-button cancel-button"><span>Cancel</span></button><button id="confirmYes" class="confirm-button confirm-yes"><span>YES</span></button></div></div> `; messageElement.className = 'custom-message confirm show'; const yesButton = messageElement.querySelector('#confirmYes'); const noButton = messageElement.querySelector('#confirmNo'); yesButton.addEventListener('click', () => handleClick(true)); noButton.addEventListener('click', () => handleClick(false)); }); } async function reportFeedback(feedbackId) { console.log('üö© Reporting feedback:', feedbackId); const confirmed = await showCustomConfirmation('Are you sure you want to report this feedback?'); if (!confirmed) { return; } if (window.DatabaseHelper && window.DatabaseHelper.reportFeedback) { const result = await window.DatabaseHelper.reportFeedback(feedbackId); if (result.success) { showCustomMessage('Feedback has been reported. Thank you for helping maintain our community standards.', 'success'); } else { showCustomMessage('Failed to report feedback. Please try again.', 'error'); } } else { showCustomMessage('Unable to report feedback. Database connection required.', 'error'); } } const commentsCache = new Map(); const CACHE_EXPIRY_TIME = 30000; function isCacheValid(feedbackId) { if (!commentsCache.has(feedbackId)) return false; const cacheData = commentsCache.get(feedbackId); const now = Date.now(); return (now - cacheData.timestamp) < CACHE_EXPIRY_TIME; } function setCacheData(feedbackId, comments) { commentsCache.set(feedbackId, { comments: comments, timestamp: Date.now() }); } function invalidateCache(feedbackId = null) { if (feedbackId) { commentsCache.delete(feedbackId); console.log(`üóã Cache invalidated for feedback: ${feedbackId}`); } else { commentsCache.clear(); console.log('üóã All cache cleared'); } } async function toggleComments(feedbackId) { const commentsContainer = document.getElementById(`comments-${feedbackId}`); const arrow = document.getElementById(`arrow-${feedbackId}`); const refreshBtn = document.getElementById(`refresh-btn-${feedbackId}`); const isVisible = commentsContainer.style.display !== 'none'; if (isVisible) { commentsContainer.style.display = 'none'; arrow.textContent = '‚ñº'; if (refreshBtn) refreshBtn.style.display = 'none'; } else { commentsContainer.style.display = 'block'; arrow.textContent = '‚ñ≤'; if (refreshBtn) refreshBtn.style.display = 'inline-block'; await loadComments(feedbackId, true); } } async function refreshComments(feedbackId) { console.log(`üîÑ Manually refreshing comments for ${feedbackId}`); invalidateCache(feedbackId); await loadCommentCount(feedbackId, true); await loadComments(feedbackId, true); showCustomMessage('Comments refreshed!', 'success'); } async function loadCommentCount(feedbackId, forceRefresh = false) { if (window.DatabaseHelper && window.DatabaseHelper.getCommentCount) { try { const count = await window.DatabaseHelper.getCommentCount(feedbackId); const countElement = document.getElementById(`count-${feedbackId}`); if (countElement) { countElement.textContent = count; console.log(`üî¢ Updated comment count for ${feedbackId}: ${count}`); } if (forceRefresh) { invalidateCache(feedbackId); } } catch (error) { console.error('‚ùå Error loading comment count:', error); } } } async function loadComments(feedbackId, forceRefresh = false) { const commentsList = document.getElementById(`comments-list-${feedbackId}`); if (!commentsList) return; if (!forceRefresh && isCacheValid(feedbackId)) { const cacheData = commentsCache.get(feedbackId); console.log(`üíæ Using cached comments for ${feedbackId}`); displayComments(feedbackId, cacheData.comments); return; } commentsList.innerHTML = ` <div class="comments-loading"><span class="loading-icon">üîÑ</span><span>Loading comments...</span></div> `; console.log(`üîÑ Loading fresh comments for ${feedbackId}${forceRefresh ? ' (forced)' : ''}`); if (window.DatabaseHelper && window.DatabaseHelper.getCommentsForFeedback) { try { const result = await window.DatabaseHelper.getCommentsForFeedback(feedbackId); if (result.success && result.comments) { setCacheData(feedbackId, result.comments); if (result.comments.length > 0) { console.log(`‚úÖ Loaded ${result.comments.length} comments for ${feedbackId}`); displayComments(feedbackId, result.comments); } else { commentsList.innerHTML = ` <div class="no-comments"><span class="no-comments-icon">üí≠</span><span>No comments yet. Be the first to comment!</span></div> `; } } else { console.error('‚ùå Failed to load comments:', result.error); commentsList.innerHTML = ` <div class="comments-error"><span class="error-icon">‚ö†Ô∏è</span><span>Failed to load comments</span><button onclick="loadComments('${feedbackId}', true)" style="margin-top: 8px; padding: 4px 8px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; color: white; cursor: pointer;">Retry</button></div> `; } } catch (error) { console.error('‚ùå Error loading comments:', error); commentsList.innerHTML = ` <div class="comments-error"><span class="error-icon">‚ö†Ô∏è</span><span>Error loading comments</span><button onclick="loadComments('${feedbackId}', true)" style="margin-top: 8px; padding: 4px 8px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; color: white; cursor: pointer;">Retry</button></div> `; } } else { commentsList.innerHTML = ` <div class="comments-error"><span class="error-icon">‚ö†Ô∏è</span><span>Comments unavailable</span></div> `; } } function displayComments(feedbackId, comments) { const commentsList = document.getElementById(`comments-list-${feedbackId}`); if (!commentsList) return; commentsList.innerHTML = ''; comments.forEach((comment, index) => { const commentElement = createCommentElement(comment); commentsList.appendChild(commentElement); setTimeout(() => { commentElement.style.opacity = '1'; commentElement.style.transform = 'translateY(0)'; }, index * 50); }); } function createCommentElement(comment) { const commentDiv = document.createElement('div'); commentDiv.className = 'comment-item'; commentDiv.style.opacity = '0'; commentDiv.style.transform = 'translateY(10px)'; commentDiv.style.transition = 'all 0.3s ease'; const date = new Date(comment.created_at); const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }); const formattedTime = date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', hour12: false }); const userIcon = comment.is_anonymous ? 'üé≠' : 'üë§'; const usernameClass = comment.is_anonymous ? 'comment-username anonymous' : 'comment-username'; const currentUser = window.currentUser || sessionStorage.getItem('currentUsername'); const isOwner = currentUser && (comment.username === currentUser || (comment.is_anonymous && comment.username === 'Anonymous' && currentUser)); console.log('üë§ Comment owner check:', { commentUsername: comment.username, currentUser: currentUser, isAnonymous: comment.is_anonymous, isOwner: isOwner }); commentDiv.innerHTML = ` <div class="comment-header"><div class="${usernameClass}"><span class="comment-user-icon">${userIcon}</span><span class="comment-user-name">${comment.username}</span></div><div class="comment-actions"><span class="comment-date">${formattedDate} ${formattedTime}</span> ${isOwner ? `<button class="comment-delete-btn" onclick="deleteComment('${comment.id}', '${comment.feedback_id}')" title="Delete comment">üóëÔ∏è</button>` : ''} <button class="comment-report-btn" onclick="reportComment('${comment.id}')" title="Report comment">‚ö†Ô∏è</button></div></div><div class="comment-text"> ${comment.comment_text} </div> `; return commentDiv; } function setupCommentInputListeners(feedbackId) { const textarea = document.getElementById(`comment-input-${feedbackId}`); const charCount = document.getElementById(`char-count-${feedbackId}`); const submitBtn = document.querySelector(`#comments-${feedbackId} .comment-submit-btn`); if (!textarea || !charCount || !submitBtn) return; textarea.addEventListener('input', function() { const length = this.value.length; charCount.textContent = length; const isEmpty = this.value.trim().length === 0; submitBtn.disabled = isEmpty; if (length > 450) { charCount.style.color = '#ff4757'; } else if (length > 400) { charCount.style.color = '#ffa502'; } else { charCount.style.color = 'var(--text-secondary)'; } }); textarea.addEventListener('keydown', function(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (!submitBtn.disabled) { submitComment(feedbackId); } } }); } async function submitComment(feedbackId) { const textarea = document.getElementById(`comment-input-${feedbackId}`); const anonymousToggle = document.getElementById(`anon-toggle-${feedbackId}`); const submitBtn = document.querySelector(`#comments-${feedbackId} .comment-submit-btn`); if (!textarea || !anonymousToggle || !submitBtn) { showCustomMessage('Comment form not found', 'error'); return; } const commentText = textarea.value.trim(); if (!commentText) { showCustomMessage('Please enter a comment', 'warning'); return; } const currentUser = window.currentUser || sessionStorage.getItem('currentUsername'); if (!currentUser || currentUser === 'Guest') { showCustomMessage('Please log in to comment', 'warning'); return; } submitBtn.disabled = true; const originalText = submitBtn.querySelector('.btn-text').textContent; submitBtn.querySelector('.btn-text').textContent = 'Posting...'; submitBtn.querySelector('.btn-icon').textContent = '‚è≥'; try { if (window.DatabaseHelper && window.DatabaseHelper.submitComment) { const commentData = { feedbackId: feedbackId, username: anonymousToggle.checked ? 'Anonymous' : currentUser, text: commentText, isAnonymous: anonymousToggle.checked }; const result = await window.DatabaseHelper.submitComment(commentData); if (result.success) { showCustomMessage('Comment posted successfully!', 'success'); textarea.value = ''; document.getElementById(`char-count-${feedbackId}`).textContent = '0'; anonymousToggle.checked = false; console.log('üîÑ Forcing comment refresh after successful post'); invalidateCache(feedbackId); await loadCommentCount(feedbackId, true); const commentsContainer = document.getElementById(`comments-${feedbackId}`); if (commentsContainer && commentsContainer.style.display === 'block') { await loadComments(feedbackId, true); } } else { showCustomMessage(result.error || 'Failed to post comment', 'error'); } } else { showCustomMessage('Comment system unavailable', 'error'); } } catch (error) { console.error('‚ùå Error submitting comment:', error); showCustomMessage('Failed to post comment', 'error'); } finally { submitBtn.querySelector('.btn-text').textContent = originalText; submitBtn.querySelector('.btn-icon').textContent = 'üìù'; submitBtn.disabled = commentText.trim().length === 0; } } async function reportComment(commentId) { const confirmed = await showCustomConfirmation('Are you sure you want to report this comment?'); if (!confirmed) return; if (window.DatabaseHelper && window.DatabaseHelper.reportComment) { const result = await window.DatabaseHelper.reportComment(commentId); if (result.success) { showCustomMessage('Comment reported successfully', 'success'); } else { showCustomMessage('Failed to report comment', 'error'); } } else { showCustomMessage('Unable to report comment', 'error'); } } async function deleteComment(commentId, feedbackId) { console.log('üóëÔ∏è Delete comment requested:', commentId); const confirmed = await showCustomConfirmation('Are you sure you want to delete this comment?'); if (!confirmed) return; const currentUser = window.currentUser || sessionStorage.getItem('currentUsername'); if (!currentUser || currentUser === 'Guest') { showCustomMessage('Please log in to delete comments', 'warning'); return; } console.log('üë§ Current user for delete:', currentUser); if (window.DatabaseHelper && window.DatabaseHelper.deleteComment) { try { const result = await window.DatabaseHelper.deleteComment(commentId, currentUser); console.log('üìù Delete result:', result); if (result.success) { showCustomMessage('Comment deleted successfully', 'success'); console.log('üîÑ Forcing comment refresh after successful delete'); invalidateCache(feedbackId); await loadCommentCount(feedbackId, true); const commentsContainer = document.getElementById(`comments-${feedbackId}`); if (commentsContainer && commentsContainer.style.display === 'block') { await loadComments(feedbackId, true); } } else { console.error('‚ùå Delete failed:', result.error); showCustomMessage(result.error || 'Failed to delete comment', 'error'); } } catch (error) { console.error('‚ùå Delete error:', error); showCustomMessage('An error occurred while deleting the comment', 'error'); } } else { showCustomMessage('Unable to delete comment - database helper not available', 'error'); } } function toggleAutoRefresh() { autoRefreshEnabled = !autoRefreshEnabled; const statusElement = document.getElementById('autoRefreshStatus'); if (autoRefreshEnabled) { statusElement.textContent = 'ON'; localStorage.setItem('kvAutoRefresh', 'true'); startAutoRefresh(); showCustomMessage('Auto-refresh enabled! Page will refresh every 15 seconds.', 'success'); } else { statusElement.textContent = 'OFF'; localStorage.setItem('kvAutoRefresh', 'false'); stopAutoRefresh(); showCustomMessage('Auto-refresh disabled. Page will not refresh automatically.', 'info'); } closeSettings(); } function startAutoRefresh() { if (!autoRefreshEnabled) return; autoRefreshInterval = setInterval(() => { if (autoRefreshEnabled) { console.log('üîÑ Auto-refresh: Clearing cache and refreshing page...'); invalidateCache(); window.location.reload(); } }, 15000); console.log('üîÑ Auto-refresh started - page will refresh every 15 seconds'); } function stopAutoRefresh() { if (autoRefreshInterval) { clearInterval(autoRefreshInterval); autoRefreshInterval = null; } console.log('‚èπÔ∏è Auto-refresh stopped'); } document.addEventListener('DOMContentLoaded', function() { const savedAutoRefresh = localStorage.getItem('kvAutoRefresh'); if (savedAutoRefresh === 'true') { autoRefreshEnabled = true; document.getElementById('autoRefreshStatus').textContent = 'ON'; console.log('üîÑ Auto-refresh was enabled - will start after page loads'); } setTimeout(() => { loadFeedbacks(); if (autoRefreshEnabled) { setTimeout(() => { startAutoRefresh(); }, 2000); } }, 500); }); async function updateFeedbackCount() { if (window.DatabaseHelper && window.DatabaseHelper.getAllFeedbacks) { const result = await window.DatabaseHelper.getAllFeedbacks(); if (result.success && result.feedbacks) { lastFeedbackCount = result.feedbacks.length; console.log(`üìÄ Initial feedback count set to: ${lastFeedbackCount}`); } else { console.log('‚ö†Ô∏è Could not get initial feedback count'); } } else { console.log('‚ö†Ô∏è DatabaseHelper not available for feedback count update'); } } async function checkForNewFeedbacks() { if (!autoRefreshEnabled) return; try { if (window.DatabaseHelper && window.DatabaseHelper.getAllFeedbacks) { const result = await window.DatabaseHelper.getAllFeedbacks(); if (result.success && result.feedbacks) { const currentCount = result.feedbacks.length; if (currentCount > lastFeedbackCount && lastFeedbackCount > 0) { console.log(`üì¢ New feedback detected! Count changed from ${lastFeedbackCount} to ${currentCount}`); showCustomMessage('New feedback posted! Refreshing page...', 'info'); setTimeout(() => { window.location.reload(); }, 2000); return; } lastFeedbackCount = currentCount; console.log(`üîç Auto-refresh check: ${currentCount} feedbacks found`); } } else { console.log('‚ö†Ô∏è DatabaseHelper not available for auto-refresh check'); } } catch (error) { console.error('‚ùå Error checking for new feedbacks:', error); } } </script><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script src="session-manager.js"></script><script src="supabase-config.js"></script><script> window.addEventListener('load', function() { console.log('üìö Initializing database connection...'); if (typeof initializeSupabase === 'function') { const initialized = initializeSupabase(); if (initialized) { console.log('‚úÖ Database ready for feedbacks'); setTimeout(() => { loadFeedbacks(); if (autoRefreshEnabled) { setTimeout(() => { console.log('üîÑ Starting simple auto-refresh'); startAutoRefresh(); }, 1000); } }, 100); } else { console.error('‚ùå Failed to initialize database'); } } else { console.error('‚ùå Supabase configuration not found'); } }); </script></body></html>
